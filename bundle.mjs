(async()=>{const t={t:0,i:0,h:0,o:0,u:"",l:"",m:!1,_:!1,v:!1,p:!1,A:!1,S:!1,B:!1,M:!1,k:!1,GPUTimer:!1,g:!1,C:0,I:!1,F:!1,L:!1,T:!1},s=t;let i=!1;const e={5120:1,5121:1,5122:2,5123:2,5124:4,5125:4,5126:4};function r(t,s){return Math.abs(t-s)<=1e-4*Math.max(1,Math.abs(t),Math.abs(s))}const n=Array;function h(){let t=new n(3);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){var s=new n(3);return s[0]=t[0],s[1]=t[1],s[2]=t[2],s}function a(){let t=new n(16);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}h(),new n(3);class c{constructor(t,i){this.U=[0,0,0,0],this.G=null,this.P=null,this.j=null,this.D=-1,this.O=[],this.R=36009,this.W=36008,this.V=17664,this.q=t,this.X=i,this.H=t.drawingBufferWidth,this.Y=t.drawingBufferHeight,this.K=new Array(s.t),this.J=new Array(s.i)}N(t,s,i,e){const n=this.U;r(n[0],t)&&r(n[1],s)&&r(n[2],i)&&r(n[3],e)||this.q.viewport(n[0]=t,n[1]=s,n[2]=i,n[3]=e)}$(){this.N(0,0,this.H,this.Y)}Z(t,s){this.G!==t&&(this.q.useProgram(s),this.G=t)}tt(t){this.G===t&&(this.q.useProgram(null),this.G=null)}st(){const t=this.R;null!==this.O[t]&&(this.q.bindFramebuffer(t,null),this.O[t]=null)}it(){const t=this.W;null!==this.O[t]&&(this.q.bindFramebuffer(t,null),this.O[t]=null)}et(t,{rt:s=9728,nt:i=[0,0],ht:e=[0,0]}={}){const r=this.W,n=this.R,h=this.O[r],o=this.O[n],a=h?h.H:this.H,c=h?h.Y:this.Y,u=o?o.H:this.H,l=o?o.Y:this.Y,[f=0,m=0,d=a,_=c]=i,[w=0,y=0,v=u,p=l]=e;this.q.blitFramebuffer(f,m,d,_,w,y,v,p,t,s)}}class u{constructor(t,s,i){this.q=t,this.ot=s,this.at=d[i],this.ct=35670!==i&&0}Set(t){this.ct!==t&&(this.q[this.at](this.ot,t),this.ct=t)}}class l{constructor(t,s,i,e){this.q=t,this.ot=s,this.at=d[i]+"v",this.ct=new w[i](_[i]*e)}Set(t){const s=this.ct;for(let i=0,e=t.length;i<e;++i)if(s[i]!==t[i])return this.q[this.at](this.ot,t),void s.set(t)}}class f{constructor(t,s,i,e){this.q=t,this.ot=s,this.at=d[i]+"v",this.ct=new Array(_[i]*e).fill(!1)}Set(t){const s=this.ct;for(let i=0,e=t.length;i<e;++i)if(s[i]!==t[i]){this.q[this.at](this.ot,t);for(let r=i;r<e;r++)s[r]=t[r];return}}}class m{constructor(t,s,i,e){this.q=t,this.ot=s,this.at=d[i],this.ct=new Float32Array(_[i]*e)}Set(t){const s=this.ct;for(let i=0,e=t.length;i<e;++i)if(s[i]!==t[i])return this.q[this.at](this.ot,!1,t),void s.set(t)}}const d=Object.create(null);d[35670]="uniform1i",d[5124]="uniform1i",d[35678]="uniform1i",d[36298]="uniform1i",d[36306]="uniform1i",d[35682]="uniform1i",d[36289]="uniform1i",d[36303]="uniform1i",d[36311]="uniform1i",d[36292]="uniform1i",d[35680]="uniform1i",d[36300]="uniform1i",d[36308]="uniform1i",d[36293]="uniform1i",d[35679]="uniform1i",d[36299]="uniform1i",d[36307]="uniform1i",d[5125]="uniform1ui",d[5126]="uniform1f",d[35664]="uniform2f",d[35665]="uniform3f",d[35666]="uniform4f",d[35667]="uniform2i",d[35668]="uniform3i",d[35669]="uniform4i",d[36294]="uniform2ui",d[36295]="uniform3ui",d[36296]="uniform4ui",d[35671]="uniform2i",d[35672]="uniform3i",d[35673]="uniform4i",d[35674]="uniformMatrix2fv",d[35675]="uniformMatrix3fv",d[35676]="uniformMatrix4fv",d[35685]="uniformMatrix2x3fv",d[35686]="uniformMatrix2x4fv",d[35687]="uniformMatrix3x2fv",d[35688]="uniformMatrix3x4fv",d[35689]="uniformMatrix4x2fv",d[35690]="uniformMatrix4x3fv";const _=Object.create(null);_[35670]=1,_[5124]=1,_[35678]=1,_[36298]=1,_[36306]=1,_[35682]=1,_[36289]=1,_[36303]=1,_[36311]=1,_[36292]=1,_[35680]=1,_[36300]=1,_[36308]=1,_[36293]=1,_[35679]=1,_[36299]=1,_[36307]=1,_[5125]=1,_[5126]=1,_[35664]=2,_[35665]=3,_[35666]=4,_[35667]=2,_[35668]=3,_[35669]=4,_[36294]=2,_[36295]=3,_[36296]=4,_[35671]=2,_[35672]=3,_[35673]=4,_[35674]=4,_[35675]=9,_[35676]=16,_[35685]=6,_[35686]=8,_[35687]=6,_[35688]=12,_[35689]=8,_[35690]=12;const w=Object.create(null);w[5124]=Int32Array,w[35678]=Int32Array,w[36298]=Int32Array,w[36306]=Int32Array,w[35682]=Int32Array,w[36289]=Int32Array,w[36303]=Int32Array,w[36311]=Int32Array,w[36292]=Int32Array,w[35680]=Int32Array,w[36300]=Int32Array,w[36308]=Int32Array,w[36293]=Int32Array,w[35679]=Int32Array,w[36299]=Int32Array,w[36307]=Int32Array,w[5125]=Uint32Array,w[5126]=Float32Array,w[35664]=Float32Array,w[35665]=Float32Array,w[35666]=Float32Array,w[35667]=Int32Array,w[35668]=Int32Array,w[35669]=Int32Array,w[36294]=Uint32Array,w[36295]=Uint32Array,w[36296]=Uint32Array;class y{constructor(t,s,i,e){this.ut=i,this.q=t,this.lt=s,this.ft=null,this.nt=e.trim(),this.dt()}get _t(){return this.ft}get wt(){return""}yt(){return this}vt(){const t=this.ft;return t&&(this.q.deleteShader(t),this.ft=null),this}dt(){const t=this.q,s=t.createShader(this.ut);return t.shaderSource(s,this.nt),t.compileShader(s),this.ft=s,this}}class v{constructor(t,s,i,e,r=Object.create(null),n=[],h=35981){this.bt=0,this.At=Object.create(null),this.St=!1,this.Bt=0,this.xt=Object.create(null),this.Mt=Object.create(null),this.q=t,this.lt=s,this.ft=null,this.kt=r,this.gt=n,this.Ct=h,[this.It,this.Ft]=p(i),[this.Lt,this.Et]=p(e),this.Tt()}get Ut(){return this.St}dt(){return this.Tt().Pt().Gt()}Tt(){this.lt.tt(this),this.St=!1,this.bt=0,this.Bt=0;const t=this.q,s=this.lt;return this.Ft||(this.Ft=new y(t,s,35633,this.It)),this.Et||(this.Et=new y(t,s,35632,this.Lt)),this.ft=t.createProgram(),this}jt(){this.Dt();const t=this.q,s=this.ft,i=t.getProgramParameter(s,35718);for(let e=0;e<i;e++){const{name:i,size:r,type:n}=t.getActiveUniform(s,e),h=t.getUniformLocation(s,i);let o=null;switch(n){case 35678:case 36298:case 36306:case 35682:case 36289:case 36303:case 36311:case 36292:case 35680:case 36300:case 36308:case 36293:case 35679:case 36299:case 36307:{const s=this.Bt++;this.xt[i]=s,t.uniform1i(h,s)}break;case 5124:case 5125:case 5126:o=r>1?l:u;break;case 35670:o=r>1?f:u;break;case 35664:case 35667:case 36294:case 35665:case 35668:case 36295:case 35666:case 35669:case 36296:o=l;break;case 35671:case 35672:case 35673:o=f;case 35674:case 35675:case 35676:case 35685:case 35686:case 35687:case 35688:case 35689:case 35690:o=m;break;default:console.error("Unrecognized type for uniform ",i)}o&&(this.Mt[i]=new o(t,h,n,r))}}vt(){const t=this.ft;return t&&(this.q.deleteProgram(t),this.ft=null,this.lt.tt(this)),this}Dt(){return this.lt.Z(this,this.ft),this}Set(t,...s){return this.Dt(),this.Mt[t]&&this.Mt[t].Set(...s),this}Pt(){const t=this.q,s=this.ft;t.attachShader(s,this.Ft._t),t.attachShader(s,this.Et._t);const i=this.gt;if(i){const e=this.Ct;t.transformFeedbackVaryings(s,i,e)}const e=this.kt;if(e)for(const i in e)t.bindAttribLocation(s,e[i],i);return t.linkProgram(this.ft),this}Ot(){return!s.F||this.q.getProgramParameter(this.ft,37297)}Gt(){if(this.St)return this;const t=this.q,s=this.ft,i=t.getProgramParameter(s,35714);this.Ft.vt(),this.Et.vt(),this.Ft=null,this.Et=null,this.jt(),this.St=i}}function p(t){return"string"!=typeof t?[t.nt,t]:[t,null]}class b{constructor(t,s,i,e=35048){this.Rt=-1,this.Wt=Object.create(null),this.ft=null,this.q=t,this.lt=s,this.Vt=e;const r=new Uint8Array(i.length),n=new Uint8Array(i.length),h=new Uint16Array(i.length);this.zt=r,this.qt=n,this.Xt=h;let o=0;for(let t=0,s=i.length;t<s;++t){const s=i[t];switch(s){case 5124:case 35670:case 5125:case 5126:r[t]=o,n[t]=1,h[t]=5124===s?5124:5125===s?5125:5126,o++;break;case 35667:case 35671:case 36294:case 35664:o+=o%2,r[t]=o,n[t]=2,h[t]=35667===s?5124:36294===s?5125:5126,o+=2;break;case 35668:case 35669:case 35672:case 35673:case 36295:case 36296:case 35665:case 35666:o+=(4-o%4)%4,r[t]=o,n[t]=4,h[t]=35669===s||35668===s?5124:36296===s||36295===s?5125:5126,o+=4;break;case 35674:case 35685:case 35686:o+=(4-o%4)%4,r[t]=o,n[t]=8,h[t]=5126,o+=8;break;case 35675:case 35687:case 35688:o+=(4-o%4)%4,r[t]=o,n[t]=12,h[t]=5126,o+=12;break;case 35676:case 35689:case 35690:o+=(4-o%4)%4,r[t]=o,n[t]=16,h[t]=5126,o+=16;break;default:console.error("Unsupported type for uniform buffer.")}}o+=(4-o%4)%4,this.Ht=o;const a=new Float32Array(o),c=a.buffer;this.Wt[5126]=this.Yt=a,this.Wt[5124]=new Int32Array(c),this.Wt[5125]=new Uint32Array(c),this.Kt=o,this.Jt=0,this.dt()}Nt(){const t=this.Kt,s=this.Jt;if(t>=s)return this;const i=4*t,e=this.Yt.subarray(t,s),r=this.q;return r.bindBuffer(35345,this.ft),r.bufferSubData(35345,i,e),r.bindBuffer(35345,null),this.Kt=this.Ht,this.Jt=0,this}vt(){const t=this.ft;return t&&(this.q.deleteBuffer(t),this.ft=null,this.$t(),this.Rt=-1),this}Qt(t){const s=this.lt.J,i=s[t];if(i===this)return;i&&(i.Rt=-1);const e=this.Rt;-1!==e&&(s[e]=void 0),this.q.bindBufferBase(35345,t,this.ft),s[t]=this,this.Rt=t}$t(){const t=this.Rt;if(-1===t)return;const s=this.lt.J;s[t]===this&&(s[t]=void 0)}Zt(t){return this.Qt(t),this}Set(t,s){const i=this.Wt[this.Xt[t]],e=this.zt[t],r=this.qt[t];return 1===this.qt[t]?i[e]=s:i.set(s,e),e<this.Kt&&(this.Kt=e),this.Jt<e+r&&(this.Jt=e+r),this}dt(){-1!==this.Rt&&this.$t();const t=this.q,s=this.q.createBuffer();return t.bindBuffer(35345,s),t.bufferData(35345,4*this.Ht,this.Vt),t.bindBuffer(35345,null),this.ft=s,this}}class A{constructor(t,s){this.ft=null,this.ts=-1,this.ss=!1,this.es=0,this.rs=1,this.ns=0,this.hs=1,this.q=t,this.lt=s}dt(){const t=this.lt;return t.j===this&&(t.j=null),null!==this.ft&&(this.ft=this.q.createVertexArray()),this}os(t,s,i){return this._SetAttributeBuffer(t,s,!1,i),this}cs(t,s,i){return this._SetAttributeBuffer(t,s,!0,i),this}us(t){const s=this.q;return null===this.ft&&(this.ft=s.createVertexArray()),this.Zt(),s.bindBuffer(34963,t._t),this.es=3*t.ls,this.ts=t.ut,this.ss=!0,this}_SetAttributeBuffer(t,s,i,r={}){const n=this.q;null===this.ft&&(this.ft=n.createVertexArray()),this.Zt(),n.bindBuffer(34962,s._t),s.fs=this;let{ut:h=s.ut,ds:o=s._s,ws:a=0,ns:c=0,ys:u=!1,vs:l=Boolean(s.ps&&!u)}=r;const f=s.bs;0===a&&(a=f*o*e[h]);const m=Math.ceil((s.As-c)/a);for(let s=0;s<f;++s)l?n.vertexAttribIPointer(t+s,o,h,a,c+s*o*e[h]):n.vertexAttribPointer(t+s,o,h,u,a,c+s*o*e[h]),i&&n.vertexAttribDivisor(t+s,1),n.enableVertexAttribArray(t+s);1===this.hs&&(i?this.rs=m:this.ss||(this.es=m)),n.bindBuffer(34962,null)}Zt(){const t=this.lt;return t.j===this||(this.q.bindVertexArray(this.ft),t.j=this),this}vt(){const t=this.ft;if(t){const s=this.q;s.deleteVertexArray(t),this.ft=null;const i=this.lt;i.j===this&&(s.bindVertexArray(null),i.j=null)}return this}}const S={5120:!0,5121:!0,5122:!0,5123:!0,5124:!0,5125:!0};class B{constructor(t,s,i,r,n,h=t.STATIC_DRAW,o=!1){let a,c,u;switch(this.ft=null,this.fs=null,i){case 35676:case 35689:case 35690:a=4;break;case 35675:case 35687:case 35688:a=3;break;case 35674:case 35685:case 35686:a=2;break;default:a=1}switch(i){case 35676:case 35688:case 35686:r=4,i=5126;break;case 35675:case 35690:case 35685:r=3,i=5126;break;case 35674:case 35687:case 35689:r=2,i=5126}"number"==typeof n?(c=n,i>0&&(n*=e[i]),u=n):(c=n.length,u=n.byteLength),this.q=t,this.ft=null,this.lt=s,this.ut=i,this._s=r,this.ls=i?c/(r*a):u/r,this.bs=a,this.As=u,this.Ss=h,this.Bs=o,this.ps=Boolean(S[i]),this.xs=o?34963:34962,this.dt(n)}get _t(){return this.ft}dt(t){t||(t=this.As);const s=this.q;return this.ft=s.createBuffer(),this.Ms(t),this}Ms(t){const s=this.q,i=this.lt,e=this.fs;e?e.Zt():i.j&&(s.bindVertexArray(null),i.j=null);const r=this.ft,n=this.xs;return s.bindBuffer(n,r),s.bufferData(n,t,this.Ss),s.bindBuffer(n,null),this}vt(){const t=this.ft;return t&&(this.q.deleteBuffer(t),this.ft=null),this}}const x=Object.create(null),M=Object.create(null);function k(t,s,i){const e=t[i];return e&&e.length>0?e.pop():new s(i)}function g(t,s){(t[s.length]??=[]).push(s)}function C(t){return k(x,Int32Array,t)}function I(t){return g(x,t)}class F{constructor(t,i,e,r=null){this.ks=null,this.gs=Object.create(null),this.Cs=new Array(s.h),this.Is=new Array(s.h),this.Fs=0,this.Ls=new Array(s.i),this.Es=new Array(s.i),this.Ts=0,this.Us=new Array(s.t),this.Gs=0,this.zt=new Int32Array(1),this.Ps=new Int32Array(1),this.js=new Int32Array(1),this.hs=1,this.Ds=!0,this.Os=4,this.q=t,this.lt=i,this.G=e,this.Rs=r}Ws(t){return this.Os=t,this}Vs(t){return this.ks=t,this}zs(t,s){const i=this.gs,e=this.Cs;let r=i[t];return void 0===r&&(r=this.Fs++,i[t]=r,e[r]=t),this.Is[r]=s,this}qs(t,s){let i=this.G.xt[t];return this.Us[i]=s,this}Xs(t,s){let i=this.G.At[t];return this.Ls[i]=s,this}Hs(...t){const s=t.length;this.hs=s;let i=this.zt,e=this.Ps,r=this.js;i.length<s&&(I(i),i=this.zt=C(s)),e.length<s&&(I(e),e=this.Ps=C(s)),r.length<s&&(I(r),r=this.js=C(s));for(let s=0;s<this.hs;++s)[i[s],e[s],r[s]=1]=t[s];return this.Ds=!1,this}Ys(){const t=this.lt,i=this.q,e=this.Rs,r=this.G,n=this.Cs,h=this.Is,o=this.Ls,a=r.bt,c=this.Us,u=r.Bt;let l=!1;r.Dt(),e&&(e.Zt(),l=e.ss,this.Ds&&(this.Ps[0]=e.es,this.js[0]=e.rs));for(let t=0;t<this.Fs;++t)r.Set(n[t],h[t]);for(let t=0;t<a;++t)o[t].Zt(t);for(let t=0;t<u;++t)c[t].Zt(t);const f=this.ks;if(f?(f.Zt(),i.beginTransformFeedback(this.Os)):t.P&&(i.bindTransformFeedback(36386,null),t.P=null),s.L){let s=t.X.L;l?s.multiDrawElementsInstancedWEBGL(this.Os,this.Ps,0,e.ts,this.zt,0,this.js,0,this.hs):s.multiDrawArraysInstancedWEBGL(this.Os,this.zt,0,this.Ps,0,this.js,0,this.hs)}else if(l)for(let t=0;t<this.hs;++t)i.drawElementsInstanced(this.Os,this.Ps[t],e.ts,this.zt[t],this.js[t]);else for(let t=0;t<this.hs;++t)i.drawArraysInstanced(this.Os,this.zt[t],this.Ps[t],this.js[t]);return this.ks&&i.endTransformFeedback(),this}}class L{constructor(s){this.Ks=Object.create(null),this.q=s,this.Js=s.canvas,(function(s){i||(t.t=s.getParameter(35661),t.i=s.getParameter(35375),t.h=Math.min(s.getParameter(36347),s.getParameter(36349)),t.o=s.getParameter(32937),t.m=Boolean(s.getExtension("EXT_color_buffer_float")),t._=Boolean(s.getExtension("OES_texture_float_linear")),t.v=Boolean(s.getExtension("WEBGL_compressed_texture_s3tc")),t.p=Boolean(s.getExtension("WEBGL_compressed_texture_s3tc_srgb")),t.A=Boolean(s.getExtension("WEBGL_compressed_texture_etc")),t.S=Boolean(s.getExtension("WEBGL_compressed_texture_astc")),t.B=Boolean(s.getExtension("WEBGL_compressed_texture_pvrtc")),t.M=Boolean(s.getExtension("WEBGL_lose_context")),t.k=Boolean(s.getExtension("WEBGL_debug_shaders")),t.GPUTimer=Boolean(s.getExtension("EXT_disjoint_timer_query_webgl2")||s.getExtension("EXT_disjoint_timer_query")),t.g=Boolean(s.getExtension("EXT_texture_filter_anisotropic")),t.C=t.g?s.getParameter(34047):1,t.I=Boolean(s.getExtension("WEBGL_debug_renderer_info")),t.I&&(t.u=s.getParameter(37445),t.l=s.getParameter(37446)),t.F=Boolean(s.getExtension("KHR_parallel_shader_compile")),t.L=Boolean(s.getExtension("WEBGL_multi_draw_instanced")||s.getExtension("WEBGL_multi_draw")),i=!0)})(s),this.lt=new c(s,this.Ks),this.Ns()}get H(){return this.lt.H}get Y(){return this.lt.Y}$s(t,s){return new F(this.q,this.lt,t,s)}Qs(t,s){return new b(this.q,this.lt,t,s)}Zs(t,s,i,e){return ArrayBuffer.isView(s)&&(e=i,i=s,s=3),new B(this.q,this.lt,t,s,i,e,!0)}ti(t,s,i){return new B(this.q,this.lt,-1,t,s,i)}si(t,s,i){return new B(this.q,this.lt,t,0,s,i)}ii(t,s,i,e){return new B(this.q,this.lt,t,s,i,e)}ei(){return new A(this.q,this.lt)}ri(t,s){return new y(this.q,this.lt,t,s)}ni(t,s,{attributeLocations:i,transformFeedbackVaryings:e,transformFeedbackMode:r}={}){return new v(this.q,this.lt,t,s,i,e,r).Pt().Gt()}hi(...t){return new Promise(((s,i)=>{const e=this.q,r=this.lt,n=t.length,h=new Array(n),o=new Array(n);let a=n;for(let s=0;s<n;++s){const[i,n,a={}]=t[s];let{transformFeedbackVaryings:c,attributeLocations:u,transformFeedbackMode:l}=a;h[s]=new v(e,r,i,n,u,c,l),o[s]=h[s]}for(let t=0;t<n;++t)h[t].Pt();!(function t(){let e=0;for(let t=0;t<a;++t)if(o[t].Ot()){if(o[t].Gt(),!o[t].Ut)return void i(new Error("Program linkage failed"));++e}else o[t-e]=o[t];a-=e,0===a?s(h):requestAnimationFrame(t)})()}))}oi(...t){return new Promise(((s,i)=>{const e=t.length,r=t.slice();let n=e;for(let s=0;s<e;++s)t[s].Tt();for(let s=0;s<e;++s)t[s].Pt();for(let s=0;s<e;++s)t[s].Ot();!(function t(){let e=0;for(let t=0;t<n;++t)if(r[t].Ot()){if(r[t].Gt(),!r[t].Ut)return void i(new Error("Program linkage failed"));++e}else r[t-e]=r[t];n-=e,0===n?s():requestAnimationFrame(t)})()}))}ai(t){return this.q.enable(t),this}ci(t){return this.q.disable(t),this}ui(t,s,i,e){return this.q.colorMask(t,s,i,e),this}li(t,s,i,e){return this.q.clearColor(t,s,i,e),this}fi(t){return this.lt.V=t,this}mi(){return this.q.clear(this.lt.V),this}di(t){return t._i(),this}wi(t){return t.yi(),this}vi(t,s){return this.q.depthRange(t,s),this}pi(t){return this.q.depthMask(t),this}bi(t){return this.q.depthFunc(t),this}Ai(t,s){return this.q.blendFunc(t,s),this}Si(t,s,i,e){return this.q.blendFuncSeparate(t,i,s,e),this}Bi(t){return this.q.blendEquation(t),this}xi(t){return this.q.stencilMask(t),this}Mi(t,s){return this.q.stencilMaskSeparate(t,s),this}ki(t,s,i){return this.q.stencilOp(t,s,i),this}gi(t,s,i,e){return this.q.stencilOpSeparate(t,s,i,e),this}Ci(t,s,i,e){return this.q.scissor(t,s,i,e),this}Ii(t,s){return this.q.polygonOffset(t,s),this}Fi(t,s,i,{Li:e=6408,ut:r=5121}={}){return this.q.readPixels(t,s,1,1,e,r,i),this}Ei(t,s){const i=this.Js;i.width=t,i.height=s;const e=this.q;return this.lt.H=e.drawingBufferWidth,this.lt.Y=e.drawingBufferHeight,this.lt.$(),this}N(t,s,i,e){return this.lt.N(t,s,i,e),this}static Ti(t,s){return t.getContext&&(t=t.getContext("webgl2",s)),new L(t)}Ns(){const t=this.q,s=this.Ks;t.getExtension("EXT_color_buffer_float"),t.getExtension("OES_texture_float_linear"),t.getExtension("WEBGL_compressed_texture_s3tc"),t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),t.getExtension("WEBGL_compressed_texture_etc"),t.getExtension("WEBGL_compressed_texture_astc"),t.getExtension("WEBGL_compressed_texture_pvrtc"),t.getExtension("EXT_disjoint_timer_query_webgl2"),t.getExtension("EXT_disjoint_timer_query"),t.getExtension("EXT_texture_filter_anisotropic"),s.k=t.getExtension("WEBGL_debug_shaders"),s.Ui=t.getExtension("WEBGL_lose_context"),t.getExtension("KHR_parallel_shader_compile"),s.L=t.getExtension("WEBGL_multi_draw_instanced")||t.getExtension("WEBGL_multi_draw")}Gi(){}}class E{constructor(){this.Pi=[],this.ji=[],this.Di=[],this.Oi=[]}}const T=new class extends E{constructor(){super(),this.Ri=new Map,this.Wi=0}recount(){this.Ri.clear(),this.Wi=0}clear(){this.Pi.length=0,this.ji.length=0,this.Di.length=0,this.Oi.length=0,this.recount()}},U=[3,2,3];function G(t,s){return(parseInt(t,10)-1)*U[s]}function P(t,s,i){if(0===i.length||i.startsWith("#"))return t;const[e,...r]=i.split(/\s+/);switch(e){case"o":return T.recount(),t=new E,s[r[0]]=t,t;case"v":return j(T,+r[0],+r[1],+r[2]),t;case"vt":return O(T,+r[0],+r[1]),t;case"vn":return D(T,+r[0],+r[1],+r[2]),t;case"f":{const s=t.Pi,{Oi:i,ji:e,Di:n,Ri:h}=T;let o=0;for(const a of r){if(4==++o){const t=s.length,i=s[t-1],e=s[t-2];s.push(i,e)}let r=-1;if(h.has(a))r=h.get(a);else{r=T.Wi++,h.set(a,r);const s=a.split("/"),[o,c,u]=s.map(G);O(t,i[c],i[c+1]),j(t,e[o],e[o+1],e[o+2]),D(t,n[u],n[u+1],n[u+2])}s.push(r)}}return t;default:throw new Error(`Unsupported OBJ command "${e}".`)}}function j(t,s,i,e){return t.ji.push(s,i,e),t}function D(t,s,i,e){return t.Di.push(s,i,e),t}function O(t,s,i){return t.Oi.push(s,i),t}const R=h(),W=h(),V=a(),z=16,q=Float32Array.of(0,0,0,0,0,z,0,z,0,0,z,z,z,0,0,z,0,z,z,z,0,z,z,z),X=Uint8Array.of(0,1,0,2,2,3,3,1,0,4,4,5,5,1,5,7,7,3,7,6,6,2,6,4),H=[0,0,0];function Y(t){return t.Vi(H)}class K{constructor(t,s){this.zi=(function(t,s,i){let e=new n(3);return e[0]=0,e[1]=0,e[2]=1,e})(),this.qi=t;const i=this.Xi=t.ei(),e=this.Hi=t.ii(5126,3,q,35044),r=this.Yi=t.Zs(5121,X,35044),h=this.zt=t.ii(5126,3,0,35048);i.os(0,e).us(r).cs(1,h),this.G=s;const o=this.Ki=t.$s(s,i);o.Ws(1),o.zs("uColor",this.zi)}static Ji(){return["#version 300 es\n#define GLSLIFY 1\nlayout(location=0)in vec3 position;layout(location=1)in vec3 offset;uniform mat4 uViewProjection;void main(){gl_Position=uViewProjection*vec4(position+offset-vec3(0.5),1.0);}","#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\nuniform vec3 uColor;out vec4 out_finalColor;void main(){out_finalColor=vec4(uColor,1.0);}"]}Ys(){this.G.Set("uColor",this.zi),this.Ki.Ys()}Ni(t){const s=t.flatMap(Y),i=(e=s.length,k(M,Float32Array,e));var e;i.set(s),this.zt.Ms(i),this.Ki.Hs([0,X.length,t.length]),g(M,i),s.length=0}$i(){this.G.vt(),this.Hi.vt(),this.Yi.vt(),this.zt.vt(),this.Xi.vt()}}const J=document.createElement("canvas"),N=L.Ti(J),$=new class{constructor({Qi:t=R,Zi:s=R,te:i=10,se:e=.3}={}){this.ie=!0,this.ee=o(t),this.re=o(s),this.te=i,this.se=e}get Qi(){return this.ee}get Zi(){return this.re}ne(t){var s,i,e;s=W,i=this.ee,e=t,s[0]=i[0]-e[0],s[1]=i[1]-e[1],s[2]=i[2]-e[2],(function(t,s){let i=s[0],e=s[1],r=s[2],n=i*i+e*e+r*r;n>0&&(n=1/Math.sqrt(n)),t[0]=s[0]*n,t[1]=s[1]*n,t[2]=s[2]*n})(W,W);const r=Math.atan2(W[2],W[0])-1.5707963267948966,n=Math.asin(W[1]),h=this.re;return h[0]=n,h[1]=r,this.he(),this}oe(){this.ie=!1}he(){this.ie=!0}ae(t){const s=this.re;return(function(t,s){const i=Math.sin(s),e=Math.cos(s);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1})(t,s[0]),(function(t,s,i){2===arguments.length&&(i=s,s=t);const e=Math.sin(i),r=Math.cos(i),n=s[0],h=s[1],o=s[2],a=s[3],c=s[8],u=s[9],l=s[10],f=s[11];s!==t&&(t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15]),t[0]=n*r-c*e,t[1]=h*r-u*e,t[2]=o*r-l*e,t[3]=a*r-f*e,t[8]=n*e+c*r,t[9]=h*e+u*r,t[10]=o*e+l*r,t[11]=a*e+f*r})(t,s[1]),(function(t,s,i){2===arguments.length&&(i=s,s=t);const e=i[0],r=i[1],n=i[2];if(s===t)t[12]=s[0]*e+s[4]*r+s[8]*n+s[12],t[13]=s[1]*e+s[5]*r+s[9]*n+s[13],t[14]=s[2]*e+s[6]*r+s[10]*n+s[14],t[15]=s[3]*e+s[7]*r+s[11]*n+s[15];else{const i=s[0],h=s[1],o=s[2],a=s[3],c=s[4],u=s[5],l=s[6],f=s[7],m=s[8],d=s[9],_=s[10],w=s[11];t[0]=i,t[1]=h,t[2]=o,t[3]=a,t[4]=c,t[5]=u,t[6]=l,t[7]=f,t[8]=m,t[9]=d,t[10]=_,t[11]=w,t[12]=i*e+c*r+m*n+s[12],t[13]=h*e+u*r+d*n+s[13],t[14]=o*e+l*r+_*n+s[14],t[15]=a*e+f*r+w*n+s[15]}})(t,(function(t,s){return t[0]=-s[0],t[1]=-s[1],t[2]=-s[2],t})(W,this.ee)),t}ce(t,s,i=1){const e=this.te*i;var r;return(r=W)[0]=0,r[1]=0,r[2]=0,t[0]?W[2]+=e:t[2]&&(W[2]-=e),t[1]?W[0]+=e:t[3]&&(W[0]-=e),s[1]?W[1]+=e:s[0]&&(W[1]-=e),this.ue(W)}Nt(t,s,i,e){this.ce(s,i,t).le(e,t)}ue(t){var s,i;return i=t,r((s=R)[0],i[0])&&r(s[1],i[1])&&r(s[2],i[2])||((function(t,s){const i=Math.sin(s),e=Math.cos(s);t[0]=e,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1})(V,-this.re[1]),(function(t,s,i){let e=s[0],r=s[1],n=s[2],h=i[3]*e+i[7]*r+i[11]*n+i[15];h=h||1,t[0]=(i[0]*e+i[4]*r+i[8]*n+i[12])/h,t[1]=(i[1]*e+i[5]*r+i[9]*n+i[13])/h,t[2]=(i[2]*e+i[6]*r+i[10]*n+i[14])/h})(W,t,V),(function(t,s,i){2===arguments.length&&(i=s,s=t),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2]})(this.ee,W),this.he()),this}le(t,s=1){const i=this.re,e=this.se,n=t[0]*s,h=t[1]*s;if(!r(h,0)){let t=i[1]+=n*e;t<0&&(t=i[1]+=6.283185307179586),t>=6.283185307179586&&(i[1]-=6.283185307179586),this.he()}if(!r(h,0)){const t=i[0]+=h*e;t<-1.5707963267948966?i[0]=-1.5707963267948966:t>1.5707963267948966&&(i[0]=1.5707963267948966),this.he()}return this}}({Qi:[3,3,3]});$.ne([0,0,0]),N.ai(2929),document.querySelector("main").append(J);const[Q,Z]=await N.hi(["#version 300 es\n#define GLSLIFY 1\nlayout(location=0)in vec3 position;layout(location=1)in vec2 uv;layout(location=2)in vec3 normal;uniform mat4 uModel;uniform mat4 uViewProjection;uniform mat3 uInverseModel;out vec2 v_uv;out vec3 v_normal;void main(){v_uv=uv;v_normal=uInverseModel*normal;gl_Position=uViewProjection*uModel*vec4(position,1.0);}","#version 300 es\nprecision mediump float;\n#define GLSLIFY 1\nout vec4 out_finalColor;void main(){out_finalColor=vec4(1.0,0.0,1.0,1.0);}"],K.Ji());Z.Dt();const tt=new K(N,Z);tt.Ni([{Vi:t=>(function(t,s,i,e){return t[0]=0,t[1]=0,t[2]=0,t})(t)}]),Q.Dt();const st=a(),it=a(),et=a(),rt=a();$.ae(et),$.oe(),Q.Set("uModel",st);const nt=(function(t){T.clear();const s=Object.create(null);let i=null;for(const e of t.split("\n"))i=P(i,s,e.trim());return s})(await(async function(t){return(await fetch("./cube.obj")).text()})()),ht=[0,0,1,1],ot=[],at=[];for(const t of Object.keys(nt))vt(ot,at,nt[t],0,0,0);const ct=N.ei(),ut=N.ti(32,new Float32Array(ot));ct.os(0,ut,{ut:5126,ds:3,ws:32}),ct.os(1,ut,{ut:5126,ds:2,ws:32,ns:12}),ct.os(2,ut,{ut:5126,ds:3,ws:32,ns:20});const lt=N.Zs(5123,new Uint16Array(at),35044);ct.us(lt);const ft=N.$s(Q,ct);N.li(0,0,0,1);const mt=[!1,!1,!1,!1],dt=[!1,!1],_t=[0,0];(J.onclick=()=>J.requestPointerLock())(),document.onpointerlockchange=()=>{document.pointerLockElement===J?J.onmousemove=t=>{_t[0]=t.movementX,_t[1]=t.movementY}:J.onmousemove=null};let wt=!1;document.onkeyup=document.onkeydown=t=>{const s="keydown"===t.type;switch(t.key){case"r":case"R":wt=s;break;case" ":dt[0]=s;break;case"Shift":dt[1]=s;break;case"w":case"W":mt[0]=s;break;case"a":case"A":mt[1]=s;break;case"s":case"S":mt[2]=s;break;case"d":case"D":mt[3]=s}};let yt=!0;(window.onresize=()=>{const t=innerWidth,s=innerHeight;N.Ei(t,s),(function(t,s,i,e,r){let n,h=1/Math.tan(.6108652381980153);t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n=1/-999.9,t[10]=1000.1*n,t[14]=200*n})(it,0,t/s),yt=!0})(),Q.Set("uModel",st),Q.Set("uViewProjection",rt);{let t=performance.now();!(function s(i){var e;e=.001*(t-i),$.Nt(e,mt,dt,_t),wt&&$.ne([0,0,0]),_t[0]=_t[1]=0,$.ie&&($.ae(et),$.oe(),yt=!0),yt&&((function(t,s,i){2===arguments.length&&(i=s,s=t);let e=s[0],r=s[1],n=s[2],h=s[3],o=s[4],a=s[5],c=s[6],u=s[7],l=s[8],f=s[9],m=s[10],d=s[11],_=s[12],w=s[13],y=s[14],v=s[15],p=i[0],b=i[1],A=i[2],S=i[3];t[0]=p*e+b*o+A*l+S*_,t[1]=p*r+b*a+A*f+S*w,t[2]=p*n+b*c+A*m+S*y,t[3]=p*h+b*u+A*d+S*v,p=i[4],b=i[5],A=i[6],S=i[7],t[4]=p*e+b*o+A*l+S*_,t[5]=p*r+b*a+A*f+S*w,t[6]=p*n+b*c+A*m+S*y,t[7]=p*h+b*u+A*d+S*v,p=i[8],b=i[9],A=i[10],S=i[11],t[8]=p*e+b*o+A*l+S*_,t[9]=p*r+b*a+A*f+S*w,t[10]=p*n+b*c+A*m+S*y,t[11]=p*h+b*u+A*d+S*v,p=i[12],b=i[13],A=i[14],S=i[15],t[12]=p*e+b*o+A*l+S*_,t[13]=p*r+b*a+A*f+S*w,t[14]=p*n+b*c+A*m+S*y,t[15]=p*h+b*u+A*d+S*v})(rt,it,et),Q.Set("uViewProjection",rt),Z.Set("uViewProjection",rt),yt=!1),N.mi(),ft.Ys(),tt.Ys(),requestAnimationFrame(s),t=i})(performance.now())}function vt(t,s,i,e,r,n,h=ht){const o=t.length/8|0,{ji:a,Pi:c,Di:u,Oi:l}=i;for(const t of c)s.push(t+o);const f=a.length/3|0,m=h[0]+1e-4,d=h[1]+1e-4,_=h[2]-2e-4,w=h[3]-2e-4;for(let s=0;s<f;s++){const i=3*s,h=2*s,o=3*s;t.push(a[i]+e,a[i+1]+r,a[i+2]+n,l[h]*_+m,l[h+1]*w+d,u[o],u[o+1],u[o+2])}}})();